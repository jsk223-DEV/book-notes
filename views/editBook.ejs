<%- include('partials/header.ejs') %>
<main id="book_details">
	<button id="back_button" onclick="goBack()">
		<svg
			xmlns="http://www.w3.org/2000/svg"
			width="24"
			height="24"
			viewBox="0 0 24 24"
			fill="none"
			stroke="white"
			stroke-width="2"
			stroke-linecap="round"
			stroke-linejoin="round"
			class="lucide lucide-arrow-big-left-icon lucide-arrow-big-left"
		>
			<path
				d="M13 9a1 1 0 0 1-1-1V5.061a1 1 0 0 0-1.811-.75l-6.835 6.836a1.207 1.207 0 0 0 0 1.707l6.835 6.835a1 1 0 0 0 1.811-.75V16a1 1 0 0 1 1-1h6a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1z"
			/>
		</svg>
	</button>
	<% if(locals.book) { %>
	<div id="bd_info">
		<%if(book.cover_id){%>
		<img
			id="bd_first_cover"
			src="https://covers.openlibrary.org/b/id/<%= book.cover_id %>-M.jpg"
		/>
		<%}else{%>
		<img id="bd_first_cover" src="images/noBookCover.jpg" />
		<%}%>
		<div id="bd_info_text">
			<div id="bd_date_added">Date Added: <%= book.date_added ? book.date_added : '' %></div>
			<h2 id="bd_title"><%= book.title ? book.title: '' %></h2>
			<p id="bd_authors"><%= book.author ? book.author : '' %></p>
			<p id="bd_description"><%= book.description ? book.description : '' %></p>
		</div>
	</div>
	<form id="new_book_form" action="/edit-book" method="POST">
		<input type="hidden" name="id" value="<%= book.id %>" />
		<fieldset>
			<legend>Edit Book</legend>
			<div
				id="covers_save"
				style="display: none"
				data-offset="0"
				data-selected="<%= book.cover_id ? book.cover_id : '' %>"
				data-covers="<%= book.covers ? book.covers.join('a') : '' %>"
				data-rating="<%= book.rating ? book.rating : 0 %>"
			></div>
			<div id="bd_covers"></div>
			<button id="bd_load_covers" type="button" class="bd-button">Load Covers</button>
			<div id="bd_save_inputs">
				<textarea id="bd_review" placeholder="Review this book" name="review">
<%= book.review && book.review%></textarea
				>
				<div id="bd_save_options">
					<div id="bd_genre_con">
						<label for="bd_genre">Genre: </label>
						<input
							type="text"
							id="bd_genre"
							name="genre"
							value="<%= book.genre ? book.genre : '' %>"
							list="genreSuggestions"
							autocomplete="none"
						/>
					</div>
					<% if(book.suggestedGenres.length > 0) { %>
					<datalist id="genreSuggestions">
						<%book.suggestedGenres.forEach(gen => {%>

						<option value="<%= gen %>"></option>
						<% }) %>
					</datalist>
					<% } %>
					<div id="bd_rating_radios">
						<span>Rate this book:</span>
						<% for(let i = 1; i < 6; i++){ %>
						<input
							class="bd-rating-radio"
							type="radio"
							name="rating"
							value="<%= i %>"
							id="rating_<%= i %>"
							onchange="updateRating(this)"
							style="display: none"
						/>
						<label for="rating_<%= i %>"
							><svg
								xmlns="http://www.w3.org/2000/svg"
								width="15"
								height="15"
								viewBox="0 0 24 24"
								fill="none"
								stroke="white"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								class="lucide lucide-star-icon lucide-star"
							>
								<path
									d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"
								/></svg
						></label>
						<% } %>
					</div>
					<div id="bd_status_con">
						<input type="radio" name="status" value="to read" id="tr_r" style="display:
						none" <%= book.status && book.status == 'to read' ? 'checked' : '' %> />
						<label for="tr_r">To Read</label>
						<input type="radio" name="status" value="reading now" id="rn_r"
						style="display: none" <%= book.status && book.status == 'reading now' ?
						'checked' : '' %> />
						<label for="rn_r">Reading Now</label>
						<input type="radio" name="status" value="have read" id="hr_r"
						style="display: none" <%= book.status && book.status == 'have read' ?
						'checked' : '' %> />
						<label for="hr_r">Have Read</label>
					</div>
					<div id="bd_buttons">
						<input type="submit" value="Save" class="bd-button" />
						<input type="button" onclick="goBack()" value="Cancel" class="bd-button" />
					</div>
				</div>
			</div>
		</fieldset>
	</form>
	<% } %>
</main>
<script src="/js/script.js"></script>
<script>
	if (document.querySelector('#covers_save').dataset.rating != 0) {
		updateRating(
			document.querySelector(
				`.bd-rating-radio[value="${document.querySelector('#covers_save').dataset.rating}"]`
			)
		);
	}
	document.querySelector('#bd_load_covers').addEventListener('click', () => {
		loadCovers(document.querySelector('#covers_save'));
	});
	loadCovers(document.querySelector('#covers_save'));
</script>

<%- include('partials/footer.ejs') %>
